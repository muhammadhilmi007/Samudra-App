<!-- Breadcrumb -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="<%= base %>dashboard">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="#">Admin</a></li>
        <li class="breadcrumb-item"><a href="<%= base %>admin/branches">Branches</a></li>
        <li class="breadcrumb-item active" aria-current="page">Edit</li>
      </ol>
    </nav>
    <h1 class="h3 mb-0">Edit Branch: <%= branch.name %></h1>
  </div>
  <a href="<%= base %>admin/branches" class="btn btn-secondary">
    <i class="bx bx-arrow-back"></i> Back to Branches
  </a>
</div>

<!-- Edit Form -->
<div class="card">
  <div class="card-body">
    <form method="POST" action="<%= base %>admin/branches/<%= branch._id %>">
      <input type="hidden" name="_method" value="PUT">
      
      <!-- Name -->
      <div class="mb-3">
        <label for="name" class="form-label">Branch Name <span class="text-danger">*</span></label>
        <input 
          type="text" 
          class="form-control <%= locals.errors && errors.name ? 'is-invalid' : '' %>" 
          id="name" 
          name="name" 
          value="<%= locals.input ? input.name : branch.name %>"
          placeholder="Enter branch name"
          required
        >
        <% if (locals.errors && errors.name) { %>
        <div class="invalid-feedback">
          <%= errors.name.message %>
        </div>
        <% } %>
      </div>

      <!-- Code -->
      <div class="mb-3">
        <label for="code" class="form-label">Branch Code <span class="text-danger">*</span></label>
        <input 
          type="text" 
          class="form-control <%= locals.errors && errors.code ? 'is-invalid' : '' %>" 
          id="code" 
          name="code" 
          value="<%= locals.input ? input.code : branch.code %>"
          placeholder="e.g., JKT-01, BDG-01"
          style="text-transform: uppercase;"
          required
        >
        <% if (locals.errors && errors.code) { %>
        <div class="invalid-feedback">
          <%= errors.code.message %>
        </div>
        <% } %>
        <div class="form-text">Use unique codes for each branch</div>
      </div>

      <!-- Address -->
      <div class="mb-3">
        <label for="address" class="form-label">Address</label>
        <textarea 
          class="form-control" 
          id="address" 
          name="address" 
          rows="3"
          placeholder="Enter branch address"
        ><%= locals.input ? input.address : branch.address %></textarea>
      </div>

      <!-- Phone -->
      <div class="mb-3">
        <label for="phone" class="form-label">Phone Number</label>
        <input 
          type="text" 
          class="form-control" 
          id="phone" 
          name="phone" 
          value="<%= locals.input ? input.phone : branch.phone %>"
          placeholder="e.g., 021-1234567"
        >
      </div>

      <!-- Type -->
      <div class="mb-3">
        <label for="type" class="form-label">Branch Type <span class="text-danger">*</span></label>
        <select 
          class="form-control <%= locals.errors && errors.type ? 'is-invalid' : '' %>" 
          id="type" 
          name="type"
          required
        >
          <option value="cabang" <%= (locals.input && input.type === 'cabang') || (!locals.input && branch.type === 'cabang') ? 'selected' : '' %>>
            Cabang
          </option>
          <option value="pusat" <%= (locals.input && input.type === 'pusat') || (!locals.input && branch.type === 'pusat') ? 'selected' : '' %>>
            Pusat
          </option>
        </select>
        <% if (locals.errors && errors.type) { %>
        <div class="invalid-feedback">
          <%= errors.type.message %>
        </div>
        <% } %>
        <div class="form-text">Pusat is for headquarters, Cabang is for branch offices</div>
      </div>

      <!-- Status -->
      <div class="mb-3">
        <div class="form-check form-switch">
          <input 
            class="form-check-input" 
            type="checkbox" 
            id="isActive" 
            name="isActive"
            <%= (locals.input && input.isActive === 'on') || (!locals.input && branch.isActive) ? 'checked' : '' %>
          >
          <label class="form-check-label" for="isActive">
            Active Status
          </label>
        </div>
        <div class="form-text">Active branches can be assigned to users and used in the system</div>
      </div>

      <!-- Buttons -->
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">
          <i class="bx bx-save"></i> Update Branch
        </button>
        <a href="<%= base %>admin/branches" class="btn btn-secondary">
          Cancel
        </a>
      </div>
    </form>
  </div>
</div>

<script>
// Auto uppercase code field
document.getElementById('code').addEventListener('input', function(e) {
  e.target.value = e.target.value.toUpperCase();
});
</script>